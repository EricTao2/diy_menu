<view class="page {{themeClass}}">
  <view class="container" wx:if="{{order}}">
    <view class="section-title">订单详情</view>
    <view class="order-meta">
      <text>订单号：{{order.orderNo}}</text>
      <text>创建时间：{{order.createdAtText}}</text>
      <order-status-tag status="{{order.status}}" text="{{order.statusText}}"></order-status-tag>
    </view>
    <view class="items">
      <block wx:for="{{order.items}}" wx:key="dishId" wx:for-item="item">
        <view class="item-card">
          <view class="item-media">
            <image src="{{item.image || '/images/default-dish.png'}}" mode="aspectFill"></image>
          </view>
          <view class="item-body">
            <view class="item-header">
              <text class="item-name">{{item.name}}</text>
              <text class="item-quantity">× {{item.quantity}}</text>
            </view>
            <view class="item-info" wx:if="{{item.options.length || item.hasRecipe}}">
              <view class="item-options" wx:if="{{item.options.length}}">
                <block wx:for="{{item.options}}" wx:key="text" wx:for-item="option">
                  <text class="item-option">{{option.text}}</text>
                </block>
              </view>
              <button
                wx:if="{{item.hasRecipe}}"
                class="item-recipe-btn item-recipe-btn--inline"
                size="mini"
                data-recipe-id="{{item.recipeId}}"
                bindtap="onViewRecipe"
              >
                菜谱
              </button>
            </view>
            <view class="item-footer">
              <text class="item-unit">{{item.unitPriceText}}</text>
              <text class="item-total">{{item.totalText}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
    <view class="remarks" wx:if="{{order.remark}}">备注：{{order.remark}}</view>
    <view class="table" wx:if="{{order.tableNo}}">桌号：{{order.tableNo}}</view>
    <view class="handle-remark">
      <text class="handle-remark__label">处理备注</text>
      <textarea
        class="handle-remark__input"
        value="{{handledRemark}}"
        placeholder="记录制作进度或特殊说明"
        auto-height
        maxlength="200"
        bindinput="onRemarkInput"
      ></textarea>
      <button class="secondary" bindtap="onSaveRemark">保存备注</button>
    </view>
    <view class="order-total">
      <text class="order-total__label">订单总价</text>
      <text class="order-total__value">{{order.totalPriceText}}</text>
    </view>
  </view>
</view>
