# DIY菜单小程序需求文档

## 1. 项目概述
构建一个支持多用户、多菜单的“DIY菜单”微信小程序，用户可按菜单分配角色进行菜单配置、浏览点餐与订单处理，界面支持多主题切换。

## 2. 用户与角色
- 微信用户可以访问多个菜单。
- 每个菜单内由菜单管理员为用户分配角色：菜单管理员、厨师、顾客。
- 同一用户在不同菜单中的角色互相独立，可以在单个菜单内拥有多种角色并自由切换。

## 3. 核心功能
### 3.1 菜单管理（管理员视图）
- 管理菜单列表，可新增菜单并在创建时自动生成“默认分类”，新建者默认获得该菜单的管理员角色。
- 提供所见即所得的菜单管理界面：左侧展示分类列表（支持拖拽排序与快捷编辑），右侧展示当前分类的菜品卡片（支持拖拽排序与快捷编辑）。
- 分类管理：新增、重命名、删除、排序，支持拖拽或权重方式自定义排序；默认分类不可删除。
- 菜品管理：维护菜品名称、描述、主图、价格、库存状态、标签、上下架状态、所属分类；在列表中可快捷上下架或进入详情页编辑，删除操作在菜品详情（编辑页）中完成。
 - 菜品管理：维护菜品名称、描述、主图、价格、库存状态、标签、上下架状态、所属分类；列表展示菜品名、价格、月售和库存等信息，名称与价格分行显示。上下架操作统一在菜品详情（编辑页）中完成，列表仅提供编辑入口。
- 菜单设置页提供“删除菜单”动作，用于彻底删除菜单以及相关分类、菜品、角色、订单等数据。
- 支持调整菜品所属分类，菜品仅能归属一个分类。
- 菜品可关联自定义选项并同步更新。

### 3.2 自定义选项库
- 在菜单级维护自定义选项，例如“辣度”。
- 每个选项包含名称和多个可选项（如“微辣”“中辣”“特辣”）。
- 菜品在关联选项时可复用菜单已创建的选项，也可新增。
- 支持设置选项是否必选、默认值、选项排序；菜品编辑页应展示选项列表，支持单击选项行或勾选框进行勾选/取消，并在保存后正确回显当前勾选。重复选择需被自动去重。

### 3.3 菜单展示（顾客视图）
- 按分类展示菜品，支持折叠、排序、关键字搜索和筛选。
- 查看菜品详情，包括图片、描述、价格、库存状态、自定义选项。
- 将菜品（含选项组合）加入购物车，支持数量调整、删除、清空。
- 提交订单时可填写备注、桌号或取餐方式。

### 3.4 订单管理
- 顾客可以提交订单，订单包含编号、状态（新建→处理中→完成/取消）、时间、总价、菜品项（含选项快照）、顾客备注。
- 顾客可查看历史订单并支持再次下单。
- 厨师收到新订单提醒后查看列表与详情，更新订单状态，记录处理备注。
- 管理员可查看订单汇总和状态分布。

### 3.5 身份切换
- 登录后展示当前菜单中已授权的角色，在进入任意菜单界面后显著提供身份切换入口，支持在同一菜单内的多身份即时切换。
- 无角色用户可申请角色或提示联系管理员。
- 切换身份后保持菜单浏览上下文（分类位置、搜索条件、购物车数据）不丢失，仅更新对应角色功能入口与权限。

### 3.6 消息与通知
- 顾客下单、订单状态流转触达相应角色（厨师/管理员/顾客）。
- 支持小程序订阅消息或站内通知；库存不足、菜品下架等异常提醒管理员。

### 3.7 多主题
- 提供多套主题皮肤（配色、字体、图标）。
- 根据用户偏好或菜单配置切换，记忆用户选择。

## 4. 业务流程
### 4.1 菜单管理员
1. 在菜单选择页可新建菜单 → 系统自动生成“默认分类”，创建者自动获得管理员身份。
2. 进入菜单管理界面，按需新增/重命名/拖拽排序分类。
3. 在同一界面维护菜品详情、拖拽调整排序、执行上下架或删除操作。
4. 分配菜单角色并配置主题与通知。
5. 如需停用，管理员可在菜单设置页删除菜单（同时清理关联数据）。

### 4.2 顾客
1. 选择菜单，若拥有多个角色则通过菜单内身份切换入口切换到顾客视图。
2. 浏览分类或搜索菜品，查看详情。
3. 选择自定义选项并加入购物车。
4. 管理购物车内容后提交订单，填写备注/桌号。
5. 在订单中心查看历史订单并可再次下单。

### 4.3 厨师
1. 进入菜单后通过身份切换入口切换至厨师视图。
2. 接收新订单通知并查看详情。
3. 更新订单状态（处理中→完成/取消），记录处理备注。
4. 查看订单历史以掌握工作量。

## 5. 数据模型与规则
- 用户：记录微信身份及各菜单对应的角色列表。
- 菜单：包含基本信息、主题配置、自定义选项库、关联分类与菜品。
- 分类：关联菜单，包含名称、排序权重。
- 菜品：关联分类和自定义选项集合，包含描述、价格、库存等。
- 自定义选项：菜单级定义，含选项名、选项项列表、必选标记、默认值。
- 购物车：按用户与菜单存储，记录菜品、数量、选项组合。
- 订单：基础信息（编号、时间、状态、支付情况）、菜品项列表（含选项快照）、备注、处理记录。
- 通知：记录通知类型、接收角色、触发事件、发送状态。
- 规则：分类与菜品在单菜单内标识唯一；菜品仅属于一个分类；自定义选项在菜单内可复用。

## 6. 权限控制
- 菜单管理员：菜单、分类、菜品、角色管理，主题配置，通知设置。
- 厨师：查看订单、更新状态、管理处理备注。
- 顾客：浏览菜单、管理购物车、提交订单、查看并复用历史订单。

## 7. 非功能需求
- 并发和一致性：库存校验、选项变更的实时同步。
- 性能与体验：界面交互流畅，常见机型流畅运行。
- 安全性：数据访问权限控制、敏感信息保护。
- 可扩展性：后续支持数据统计、支付接入、多门店拓展。
- 表单校验与提示：业务上要求为数字的输入框（如价格、库存、排序权重等）必须在前端完成格式校验，校验失败时阻止提交，并以页面中部的浮层提示框展示错误原因；该提示框自动在 2 秒后或用户点击遮罩时关闭。
