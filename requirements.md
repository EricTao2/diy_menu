# DIY菜单小程序需求文档

## 1. 项目概述
构建一个支持多用户、多菜单的“DIY菜单”微信小程序，用户可按菜单分配角色进行菜单配置、浏览点餐与订单处理，界面支持多套UI主题切换。

## 2. 用户与角色
- 用户首次进入小程序时，弹窗让用户设置头像、昵称，并提供按钮让用户一键填充自己的微信昵称和头像
- 微信用户可以访问多个菜单。
- 每个菜单内由菜单管理员为用户分配角色：菜单管理员、厨师、顾客。
- 同一用户在不同菜单中的角色互相独立，可以在单个菜单内拥有多种角色并自由切换。

## 3. 核心功能
### 3.1 菜单选择
- 顶部是用户区域，显示用户的头像、昵称，并提供编辑按钮，运行用户修改。
- 下方是菜单选择区域，首先是"新建菜单"的按钮，允许用户创建菜单，用户创建菜单后默认拥有菜单管理员的角色。其次列出用户的所有菜单，用户如果在某菜单内拥有一个角色，则可以在菜单选择页面看到这个菜单
- 用户在选择菜单与角色后，可以点击以特定角色进入菜单页面

### 3.2 菜单页面-管理员视图
- 创建菜单时自动生成一个菜品分类：“默认分类”
- 菜单页面由多个tab页面构成，分别是:菜单管理、菜单设置、自定义选项库、订单管理

#### 3.2.1 菜单管理
- 页面上方区域第一行是一些功能按钮，有按钮:菜单选择、角色切换、新增菜品。同一行的按钮样式应该一样，只是位置不同。再下方为菜单图片和菜单描述。
- 页面中间区域为菜品分类和菜品列表
- 菜品分类：支持拖拽方式自定义排序菜品分类
- 菜品列表：展示菜品列表，并可以拖拽排序。点击菜品编辑按钮可进入菜品编辑页面。同一类的菜品列表滑动到末尾后，展示下一个分类的菜品列表，并在一个分类起始时，在菜品列表中用文字标识，方便用户观察到后续菜品是一个新的分类。
- 菜品编辑页面：维护菜品名称、描述、主图、价格、库存状态、标签、上下架状态、所属分类。菜品仅能归属一个分类。菜品可关联自定义选项并同步更新。页面底部有两个按钮"删除菜品","保存菜品"

#### 3.2.2 菜单设置
- 编辑菜单的名称、描述、主图、主题、菜品分类。
- 菜品分类的编辑区域列出当前菜单的所有分类，并按照排序顺序列出，对每个分类都可以移动排序和编辑。
- 自定义选项编辑区域：列出现有的所有自定义选项，每个选项下方有"编辑","删除"两个按钮，点击编辑触发选项的编辑功能，点击删除，删除掉这个自定义选项。区域上方有一个"新建选项"的按钮，点击后可以新增自定义选项。每个自定义选项都必须有默认选项。
- 页面底部有两个按钮"删除菜单","保存菜单"

#### 3.2.3 菜品订单
- 展示顾客在这个菜单中下单的点菜订单

#### 3.2.4 菜单用户
- 可以分享菜单给其他用户，分享方式包括两种方式：链接分享
- 链接分享：生成分享链接，用户点击分享链接后将唤起该小程序，将操作用户添加到该菜单，并授予顾客身份。然后自动进入对应的菜单页面。
- 分页列出当前菜单下的所有用户，一页20条。按照用户身份角色顺序列出：管理员、厨师、顾客。如果用户存在多个角色，也只展示一条数据，但是会在数据行上用类似tag的形式标注用户当前的所有身份。
- 身份管理：每行列出的用户上有编辑按钮，可以新增，删除用户的角色。

### 3.3 菜单页面-顾客视图
- 菜单页面由多个tab页面构成，分别是:点菜、购物车、订单

#### 3.3.1 点菜
- 页面上方区域第一行是一些功能按钮，有按钮:菜单选择、角色切换（如果用户还有其他角色时才展示）。再下方为菜单图片和菜单描述。
- 页面中间区域为菜品分类和菜品列表
- 菜品列表：展示菜品列表，并在菜品右侧有"+"号的按钮，用户点击后，如果该菜品没有关联自定义选项，则直接将一份该菜品加入到购物车，如果该菜品关联了自定义选项，则弹窗让用户进行自定义选项的选择，弹窗右上角有关闭按钮，右下方有"加入购物车"按钮。同一类的菜品列表滑动到末尾后，展示下一个分类的菜品列表，并在一个分类起始时，在菜品列表中用文字标识，方便用户观察到后续菜品是一个新的分类。
- 页面底部右下角有按钮："去下单"，用户点击后进入下单页面
- 下单页面：自动将购物车内的菜品添加到下单页面中列出展示，如果有部分菜品已下架或者被删除(即无效状态)，弹窗提示用户"部分菜品已失效，已自动过滤".页面右下角有按钮"下单"，用户点击后即创建对应订单。


#### 3.3.3 订单
- 顾客可以提交订单，订单包含编号、状态（新建→处理中→完成/取消）、时间、总价、菜品项（含选项快照）、顾客备注。
- 顾客可查看历史订单并支持再次下单。
- 厨师收到新订单提醒后查看列表与详情，更新订单状态，记录处理备注。
- 管理员可查看订单汇总和状态分布。

### 3.5 身份切换
- 登录后展示当前菜单中已授权的角色，用户可手动切换界面。
- 无角色用户可申请角色或提示联系管理员。

### 3.6 消息与通知
- 顾客下单、订单状态流转触达相应角色（厨师/管理员/顾客）。
- 支持小程序订阅消息或站内通知；库存不足、菜品下架等异常提醒管理员。

## 4. 业务流程
### 4.1 菜单管理员
1. 创建菜单 → 自动生成“默认分类”。
2. 根据需要新增分类并排序。
3. 创建菜品并设置分类、自定义选项、上下架状态。
4. 分配菜单角色并配置主题、通知。

### 4.2 顾客
1. 选择菜单并切换到顾客视图。
2. 浏览分类或搜索菜品，查看详情。
3. 选择自定义选项并加入购物车。
4. 管理购物车内容后提交订单，填写备注/桌号。
5. 在订单中心查看历史订单并可再次下单。

### 4.3 厨师
1. 切换至厨师视图。
2. 接收新订单通知并查看详情。
3. 更新订单状态（处理中→完成/取消），记录处理备注。
4. 查看订单历史以掌握工作量。

## 5. 数据模型与规则
- 用户：记录微信身份及各菜单对应的角色列表。
- 菜单：包含基本信息、主题、自定义选项库、关联分类与菜品。
- 分类：关联菜单，包含名称、排序权重。
- 菜品：关联分类和自定义选项集合，包含描述、价格、库存等。
- 自定义选项：菜单级定义，含选项名、选项项列表、默认值。
- 购物车：按用户与菜单存储，记录菜品、数量、选项组合。
- 订单：基础信息（编号、时间、状态、支付情况）、菜品项列表（含选项快照）、备注、处理记录。
- 通知：记录通知类型、接收角色、触发事件、发送状态。
- 规则：分类与菜品在单菜单内标识唯一；菜品仅属于一个分类；自定义选项在菜单内可复用。

## 6. 权限控制
- 菜单管理员：菜单、分类、菜品、角色管理，通知设置。
- 厨师：查看订单、更新状态、管理处理备注。
- 顾客：浏览菜单、管理购物车、提交订单、查看并复用历史订单。

## 7. 非功能需求
- 性能与体验：界面交互流畅，常见机型流畅运行。

